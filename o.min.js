function o(e){function n(){for(var e,n={},t=0,r=arguments.length;r>t;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&(n[e]=arguments[t][e]);return n}return base=this,base.oConfig=base.oConfig||{endpoint:null,format:"json",version:4,strictMode:!0,start:null,ready:null,error:null,headers:[],username:null,password:null,isAsync:!0,isCors:!0,openAjaxRequests:0},base.config=function(e){base.oConfig=n(base.oConfig,e)},base.isEndpoint=function(){return null!==base.oConfig.endpoint},"undefined"==typeof e?base:new oData(e,base.oConfig)}function oData(e,n){function t(e,n,t,r){if(O(n)){var a="",o=[];for(i=0;i<n.length;++i)o[i]="("+e+" "+t+" "+n[i][e]+")";return a=o.join(" "+r+" ")}return""}function r(e,n,t){for(var t=t||(4==oConfig.version?"contains":"substringof"),r=n.split(" "),a="contains"===t||"substringof"===t,o=[],i=0;i<e.length;i++){var u=[];if(a)for(var s=0;s<r.length;s++)u.push(t+"("+e[i]+",'"+r[s]+"')");else u.push(e[i]+" "+t+" '"+n+"'");o.push("("+u.join("and")+")")}return o.join("or")}function a(e){for(var n=0;n<B.length;n++){var t=(E(e,"#")?"#":"")+B[n].routeName,r=!1;if(P(t,"?")&&(t=t.substring(0,t.length-1),r=!0),t===e&&l(B[n].callback),r&&E(e,P(t,"/")?t:t+"/")){for(var a=e.substring(t.length+1).split("/"),o=0,i=0;i<J.path.length;i++)null!==J.path[i].get&&(J.path[i].get=a[o],o=i);for(var i=0;i<J.queryList.length;i++)null!==J.query[J.queryList[i].name]&&"$format"!==J.queryList[i].name&&"$expand"!==J.queryList[i].name&&("undefined"!=typeof a[o]&&""!==a[o]&&(a[o]=T(a[o],a[o]),"$filter"!==J.queryList[i].name&&(J.queryList[i].value=a[o])),o++);if("undefined"!=typeof J.query.$filter)J.queryList[J.query.$filter].value=H(J.queryList[J.query.$filter].original,a);else if("undefined"!=typeof J.query.$search){var u=[a[0]];"string"==typeof a[0]&&(u=a[0].split(" ")),J.queryList[J.query.$search].value="";for(var i=0;i<u.length;i++)J.queryList[J.query.$search].value+="("+H(J.queryList[J.query.$search].original,u[i])+") and ";J.queryList[J.query.$search].value=J.queryList[J.query.$search].value.substring(0,J.queryList[J.query.$search].value.length-4)}base.param=[],base.param=a,l(B[n].callback)}}}function o(e){return JSON?JSON.parse(JSON.stringify(e)):void A("No JSON Support.")}function u(e){for(key in X)e=e.split(key).join(" "+X[key]+" ");return e}function s(e){J&&Y.push(J),J="string"==typeof e?c(e):e,C("$format")||g("$format",base.oConfig.format)}function f(e,n,t){if(null===J&&A('You must define a resource to perform a get(), post(), put() or delete() function. Define a resource with o("YourODataResource").'),0!==Y.length||t){Y.push(J);var r=j(J.method,h());if(S(["POST","PATCH","DELETE"])<=1&&t&&!I)k(r,L(J.data),e,n,!1,[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/json"},{name:"Content-Length",value:L(J.data).length}]),w(["POST","PATCH","DELETE"]);else{var a=q();k(j("POST",base.oConfig.endpoint+(P(base.oConfig.endpoint,"/")?"":"/")+"$batch"),N(a,t),e,n,!0,[{name:"Content-Type",value:"multipart/mixed; boundary=batch_"+a}]),t&&w(["POST","PUT","DELETE"])}}else k(j("GET",h()),null,e,n,!1)}function l(e){""!==J.path[0].resource?f(e):e(null)}function d(e){return"undefined"==typeof e?base:(e.toUpperCase().indexOf("HTTP://")>-1||e.toUpperCase().indexOf("HTTPS://")>-1?G=!1:base.oConfig.endpoint||A("You can not use resource query without defining your oData endpoint. Use o().config({endpoint:youeEndpoint}) to define your oData endpoint."),routeName=e,s(e),base)}function p(e){C("$expand")?(J.queryList[J.query.$expand].value+=","+e,J.queryList[J.query.$expand].original=J.queryList[J.query.$expand].value):g("$expand",e,e)}function h(e){var n=e||J;n&&0!==n.path.length||A('No resource defined. Define a resource first with o("YourResourcePath").');var t="";G&&(t=base.oConfig.endpoint+(P(base.oConfig.endpoint,"/")?"":"/"));for(var r=0;r<n.path.length;r++)t+=n.path[r].resource,n.path[r].get&&(t+="("+n.path[r].get+")"),t+="/";return t+n.appending+v()}function c(e){var n=e.split("?"),t=e,r="",a={path:[],appending:"",query:{},queryList:[],method:"GET",data:null};if(2===n.length){t=n[0],r=n[1];for(var o=r.split("&"),i=0;i<o.length;i++){var u=o[i].split("=");a.queryList.push({name:u[0],value:u[1]}),a.query[u[0]]=a.queryList.length-1}}for(var s=t.split("/"),i=0;i<s.length;i++)if(E(s[i],"$")&&"$link"!==s[i])a.appending=s[i];else{var f=s[i].split("(");a.path.push(1===f.length?{resource:s[i],get:null}:{resource:f[0],get:f[1].substring(0,f[1].length-1)})}return a}function g(e,n,t,r){t=t||null,J.queryList.push({name:e,value:n,original:t}),J.query[r||e]=J.queryList.length-1}function y(e,n,t,r,a){t=t||null,r=r||" or ",e=a||e,J.queryList[J.query[e]].value="("+J.queryList[J.query[e]].value+")"+r+"("+n+")",t&&(J.queryList[J.query[e]].original=J.queryList[J.query[e]].value)}function b(e){J.query[e]=null}function v(){var e="";for(queryName in J.query)J.query.hasOwnProperty(queryName)&&null!=J.query[queryName]&&(e+="&"+J.queryList[J.query[queryName]].name+"="+J.queryList[J.query[queryName]].value);return e.length>0?"?"+e.substring(1):""}function m(e){if(C(e)){var n=e;return O(n)&&(n=n.join(",")),A("There is already a depending query. You can not use them together/twice: "+n),!0}return!1}function C(e){for(var n=O(e)?e:[e],t=!1,r=0;r<n.length;r++)J.query.hasOwnProperty(n[r])&&(t=!0);return t}function q(){var e=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==n?t:7&t|8).toString(16)});return n}function x(e,n){var t=T(e,null);return null!==t&&t>=0?t:void A(n+": Parameter must be an integer value and positive.")}function $(e,n){return"undefined"!=typeof e&&null!==e&&e.length>0?e:void A(n+": Parameter must be set.")}function T(e,n){if("number"==typeof e)return e;var t=n;return e&&e.length>0&&(isNaN(e)||(t=parseInt(e))),t}function S(e){for(var n=0,t=0;t<Y.length;t++)e.indexOf(Y[t].method)>-1&&n++;return n}function w(e){for(var n=[],t=0;t<Y.length;t++)e.indexOf(Y[t].method)>-1&&n.push(t);for(var t=n.length-1;t>=0;t--)Y.splice(n[t],1);Y[0]&&(J=Y[0])}function L(e){return JSON?JSON.stringify(e):(A("No JSON support."),e)}function O(e){return"undefined"==typeof Array.isArray?"[object Array]"===e.toString():Array.isArray(e)}function P(e,n){return e?-1!==e.indexOf(n,e.length-n.length):!1}function E(e,n){return 0===e.indexOf(n)}function A(e){function n(e){this.message=e,this.name="o.js exception"}if(n.prototype=new Error,base.oConfig.strictMode===!0)throw new n(e);console.log("o.js exception: "+e)}function N(e,n){var t="",r=q(),a=!1;n&&(t+="--batch_"+e+"\n",t+="Content-Type: multipart/mixed; boundary=changeset_"+r+"\n\n");for(var o=0;o<Y.length;o++){var i=Y[o];if(J=i,"GET"!==i.method||n){if(("POST"===i.method||"PUT"===i.method||"PATCH"===i.method||"DELETE"===i.method)&&n){var u=L(i.data);t+="--changeset_"+r+"\n",t+="Content-Type: application/http\n",t+="Content-Transfer-Encoding: binary\n",t+="Content-ID:"+o+"1\n\n",t+=i.method+" "+h(i)+" HTTP/1.1\n",t+="Host: "+base.oConfig.endpoint+"\n",t+="Content-Type: application/json\n",t+="Content-Length:"+u.length+"\n\n",t+=L(J.data)+"\n\n\n",a=!0}}else t+="--batch_"+e+"\n",t+="Content-Type: application/http\n",t+="Content-Transfer-Encoding: binary\n\n",t+=i.method+" "+h(i)+" HTTP/1.1\n",t+="Host: "+base.oConfig.endpoint+"\n\n"}return a&&(t+="--changeset_"+r+"--\n\n"),t+="--batch_"+e+"--"}function k(e,n,t,r,a,o){base.oConfig.start&&null==U&&(base.oConfig.openAjaxRequests++,base.oConfig.start()),U&&U[0]&&U[0](!0);var i=base;if(I&&(e.onload=function(){e.readyState=4,e.status=200,e.onreadystatechange()},e.onerror=function(){e.readyState=0,e.status=400,e.onreadystatechange()}),e.onreadystatechange=function(){if(4===e.readyState){if(e.status>=200&&e.status<300){if(204===e.status);else if(a){for(var n=e.responseText.split("\n"),o=0,u=[],s=0;s<n.length;s++)E(n[s],"{")&&(D(n[s],i),u.push(i.data),o++);i.data=u}else D(e.responseText,i);M&&M.resolve(i),"function"==typeof t&&t.call(i,i.data)}else try{var f=e.responseText;if(JSON&&""!=e.responseText&&(f=JSON.parse(e.responseText)),""!==f&&f["odata.error"]){var l=f["odata.error"].message.value+" | HTTP Status: "+e.status+" | oData Code: "+f["odata.error"].code;A(l)}else A("Request failed with HTTP status "+e.status+" on ready state "+e.readyState)}catch(d){if(R(i,!0,e.status),"undefined"!=typeof r)r(e.status,d);else{if(!M)throw d;M.reject(e.status,d)}}R(i,!1)}},base.oConfig.username&&base.oConfig.password&&(I&&A("CORS and Basic Auth is not supported for IE <= 9. Try to set isCors:false in the OData config if you do not need CORS support."),e.setRequestHeader("Authorization","Basic "+_(base.oConfig.username+":"+base.oConfig.password))),!I){if(o)for(var u=0;u<o.length;u++)e.setRequestHeader(o[u].name,o[u].value);if(base.oConfig.headers.length>0)for(var u=0;u<base.oConfig.headers.length;u++)e.setRequestHeader(base.oConfig.headers[u].name,base.oConfig.headers[u].value)}e.send(n)}function R(e,n,t){e.oConfig.ready&&null==U&&(e.oConfig.openAjaxRequests--,e.oConfig.openAjaxRequests<=0&&e.oConfig.ready()),U&&U[1]&&U[1](!1),e.oConfig.error&&n&&e.oConfig.error(t)}function D(e,n){var t=T(e,-1);if(-1!==t)n.data=t;else if(JSON){var r=JSON.parse(e);r.hasOwnProperty("value")?(n.data=C(["$first"])&&r.value.length&&r.value.length<=1?r.value[0]:r.value,(r.hasOwnProperty("odata.count")||r.hasOwnProperty("@odata.count"))&&(n.inlinecount=r["odata.count"]||r["@odata.count"])):n.data=r,J.data=n.data}else n.data=e}function j(e,n){var t=new XMLHttpRequest;return base.oConfig.isCors&&"withCredentials"in t?t.open(e,n,base.oConfig.isAsync):base.oConfig.isCors&&"undefined"!=typeof XDomainRequest?(t=new XDomainRequest,I=!0,"GET"==e?t.open(e,n):t.open("POST",n)):t.open(e,n,base.oConfig.isAsync),t}function H(){var e=arguments[0],n=arguments[1];if(n.lenght)for(var t=0;t<n.length;t++){var r=new RegExp("{["+t+"]}","g");e=e.replace(r,n[t])}else{var r=new RegExp("{[0]}","g");e=e.replace(r,n)}return e}function _(e){var n={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,r,a,o,i,u,s,f="",l=0;for(e=n._utf8_encode(e);l<e.length;)t=e.charCodeAt(l++),r=e.charCodeAt(l++),a=e.charCodeAt(l++),o=t>>2,i=(3&t)<<4|r>>4,u=(15&r)<<2|a>>6,s=63&a,isNaN(r)?u=s=64:isNaN(a)&&(s=64),f=f+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(u)+this._keyStr.charAt(s);return f},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var n="",t=0;t<e.length;t++){var r=e.charCodeAt(t);128>r?n+=String.fromCharCode(r):r>127&&2048>r?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(63&r|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(63&r|128))}return n}};return n.encode(e)}base=this;var J=null,Y=[],B=[],G=!0,M=null,U=null,I=!1,X={"==":"eq","===":"eq","!=":"ne","!==":"ne",">":"gt",">=":"ge","<":"lt","<=":"le","&&":"and","||":"or","!":"not","+":"add","-":"sub","*":"mul",".":"/","%":"mod"};return base.data=[],base.inlinecount=null,base.param=[],base.oConfig=n,base.routes=base.route=function(e,n){O(e)||(e=[e]);for(var t=window.location.hash,r=0;r<e.length;r++)"undefined"!=typeof n?B.push({routeName:e[r],callback:n,interval:setInterval(function(){window.location.hash!=t&&(t=window.location.hash,a(window.location.hash))},100)}):A('Routes without a callback are not supported. Please define a function like .route("YourRoute", function() { }).');return base.triggerRoute(window.location.hash),base},base.isEndpoint=function(){return G},base.triggerRoute=function(e){return a(e),base},base.find=function(e){return J.path[J.path.length-1].get=x(e,"find()"),base},base.top=base.take=function(e){return m(["$top"])||g("$top",x(e,"take()")),base},base.skip=function(e){return m("$skip")||g("$skip",x(e,"skip()")),base},base.first=function(){return m(["$top","$first"])||g("$top",1,null,"$first"),base},base.filter=function(e){var n=$(u(e));return C("$filter")?y("$filter",n,n):g("$filter",n,n),base},base.any=function(e,n){var t=e+"/any(x:x/"+u($(n))+")";return C("$filter")?y("$filter",t,t):g("$filter",t,t),base},base.orderBy=function(e){return m("$orderby")||g("$orderby",$(e)),base},base.select=function(e){return g("$select",$(e)),base},base.count=function(){return b("$format"),J.appending="$count",base},base.inlineCount=function(e){return 4==oConfig.version?(e=e||"true",m("$count")||g("$count",e)):(e=e||"allpages",m("$inlinecount")||g("$inlinecount",e)),base},base.batch=function(e){return s(e),base},base.expand=function(e){return p(e),base},base.loading=function(e,n){return n=n||e,U=e?[e,n]:[function(){},function(){}],base},base.ref=base.link=function(e,n){b("$format"),(null==J||J.get)&&A("You need to define a resource with the find() method to append an navigation property"),oConfig.version<4?(J.method="POST",J.path.push("$link"),J.path.push({resource:e,get:null})):(J.method="POST",J.path.push({resource:e,get:null}),J.appending="$ref");var t=c(e);t.path[t.path.length-1].get=n;var r=h(t);return J.data={"@odata.id":r.substring(0,r.length-1)},base},base.removeRef=base.deleteRef=function(e,n){if(b("$format"),(null==J||J.get)&&A("You need to define a resource with the find() method to append an navigation property"),oConfig.version<4?(J.method="POST",J.path.push("$link"),J.path.push({resource:e,get:null})):(J.method="POST",J.path.push({resource:e,get:null}),J.appending="$ref"),n){var t=c(e);t.path[t.path.length-1].get=n;var r=h(t);g("$id",r.substring(0,r.length-1))}return J.method="DELETE",base},base.get=function(e,n){return"undefined"!=typeof Q&&(M=Q.defer()),f(e,n,!1),"undefined"!=typeof Q?M.promise:base},base.save=function(e,n){if("GET"===J.method&&null!==J.data){var t=o(J);t.method="PATCH",t.data=J.data,s(t)}return M||"undefined"==typeof e?(M=Q.defer(),f(e,n,!0),M.promise):(f(e,n,!0),base)},base.post=function(e,n){return b("$format"),n&&s(n),J.method="POST",J.data=e,base},base.patch=base.put=function(e,n){return n&&s(n),J.path[0]&&J.path[0].get||A("Bulk updates are not supported. You need to query a unique resource with find() to patch/put it."),J.method="PATCH",J.data=e,base},base.remove=base["delete"]=function(e){return e&&s(e),J.path[0]&&J.path[0].get||A("Bulk deletes are not supported. You need to query a unique resource with find() to delete it."),J.method="DELETE",base},base.query=function(e){return h(e)},base.search=function(e,n,t,a){var o=r(e,n,t);return 4==oConfig.version&&a?m("$search")||g("$search",o,o):m("$filter")||g("$filter",o,o,"$search"),base},base.filterByList=base.exclude=function(e,n){if(!m("$filter")){var r=t(e,n,X["!="],X["&&"]);g("$filter",$(r),r)}return base},base.include=function(e,n){if(!m("$filter")){var r=t(e,n,X["=="],X["||"]);g("$filter",$(r),r)}return base},d(e)}